<body>
  <app-loader *ngIf="load == true" class="divloader"> </app-loader>

  <app-maskloader *ngIf="maskLoad"></app-maskloader>

<div *ngIf="load != true">

  <div class="table">
    <div class="tabletop">
      <div class="add">
        <button *ngIf="loginType" class="button addBtn" (click)="showDialog()" ><fa-icon [icon]="add" [size]="'lg'"></fa-icon></button>
      </div>
      <div class="search">
        <span class="p-input-icon-left ml-auto">
          <i class="pi pi-search"></i>
          <input pInputText type="text" (input)="dt5.filterGlobal($any($event.target).value, 'contains')" placeholder="Search keyword" />
        </span>
      </div>
      <div class="delete">
        <button *ngIf="loginType" class="button delBtn" role="button" [disabled]="!selected.length" (click)="deleteselectedRows()" ><fa-icon [icon]="del" [size]="'lg'"></fa-icon></button>
      </div>
    </div>
    <p-table #dt5 id="exportkvatable" [value]="KVAData" [tableStyle]="{ 'width': '100%' }" styleClass="p-datatable-gridlines"
      [(selection)]="selected"
      [paginator]="true"
      [rows]="50"
      [rowsPerPageOptions]="[50,100,500,1000]"
      [loading]="loading"
      [globalFilterFields]="['kva_unitname', 'kva_alldemand', 'kva_Costforkva', 'kva_penaltycost', 'kva_minpercentage']"
      class="custom-table"
      [scrollable]="true"
      [scrollHeight]="TableHeight"
      >
      <ng-template pTemplate="header">
        <tr>
            <th *ngIf="loginType" style="width: 4rem">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th pSortableColumn="kva_unitname">UNITNAME <p-sortIcon field="kva_unitname"></p-sortIcon></th>
            <th pSortableColumn="kva_alldemand">ALLOCATED DEMAND <p-sortIcon field="kva_alldemand"></p-sortIcon></th>
            <th pSortableColumn="kva_Costforkva">COST FOR KVA <p-sortIcon field="kva_Costforkva"></p-sortIcon></th>
            <th pSortableColumn="kva_penaltycost">PENALTY COST /KVA <p-sortIcon field="kva_penaltycost"></p-sortIcon></th>
            <th pSortableColumn="kva_minpercentage">MINIMUM % <p-sortIcon field="kva_minpercentage"></p-sortIcon></th>
            <th *ngIf="loginType">EDIT</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-Kva>
        <tr>
            <td *ngIf="loginType">
              <p-tableCheckbox [value]="Kva"></p-tableCheckbox>
            </td>
            <td>{{Kva.kva_unitname}}</td>
            <td>{{Kva.kva_alldemand}}</td>
            <td>{{Curr.symbol}} {{Kva.kva_Costforkva}}</td>
            <td>{{Curr.symbol}} {{Kva.kva_penaltycost}}</td>
            <td>{{Kva.kva_minpercentage}}</td>
            <td *ngIf="loginType"><button class="edtBtn" role="button" (click)="EditModal(Kva)" ><fa-icon [icon]="edit" [size]="'lg'"></fa-icon></button></td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-Data>
      <tr>
        <td class="footd" colspan="7">No Data Available</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorright">
      <button class="Btn" (click)="exportExcel()">
        <div class="sign"><i class="fi fi-sr-file-excel"></i></div>
        <div class="text">EXPORT</div>
      </button>        
    </ng-template>
    </p-table>
  </div>

</div>
</body>



<p-dialog [(visible)]="DisplayModal" [draggable]="false" [closable]="false" [modal]="true">

  <div class="formdiv">

    <form [formGroup]="form"  class="form">

      <div class="form-control">
        <label for="name">Unitname</label>
          <select formControlName="kva_unitname">
            <option value="">-- Select Plant --</option>
            <option *ngFor="let meter of plants" [value]="meter.name">
              {{ meter.name }}
            </option>
          </select>
          <div *ngIf="form.get('kva_unitname')?.invalid && (form.get('kva_unitname')?.dirty || form.get('kva_unitname')?.touched)" class="error">
            <div *ngIf="form.get('kva_unitname')?.errors!required">
              *required
            </div>
          </div>
      </div>

      <div class="form-control">
        <label for="name">Allocated Demand</label>
        <input type="number" formControlName="kva_alldemand" placeholder="Enter" required>
        <div *ngIf="form.get('kva_alldemand')?.invalid && (form.get('kva_alldemand')?.dirty || form.get('kva_alldemand')?.touched)" class="error">
          <div *ngIf="form.get('kva_alldemand')?.errors!required">
            *required
          </div>
        </div>
      </div>

      <div class="form-control">
        <label for="name">Cost for KVA in {{Curr.code}}</label>
        <input type="number" formControlName="kva_Costforkva" placeholder="Enter" required>
        <div *ngIf="form.get('kva_Costforkva')?.invalid && (form.get('kva_Costforkva')?.dirty || form.get('kva_Costforkva')?.touched)" class="error">
          <div *ngIf="form.get('kva_Costforkva')?.errors!required">
            *required
          </div>
        </div>
      </div>

      <div class="form-control">
        <label for="name">Penelty Cost (per KVA) in  {{Curr.code}}</label>
        <input type="number" formControlName="kva_penaltycost" placeholder="Enter" required>
        <div *ngIf="form.get('kva_penaltycost')?.invalid && (form.get('kva_penaltycost')?.dirty || form.get('kva_penaltycost')?.touched)" class="error">
          <div *ngIf="form.get('kva_penaltycost')?.errors!required">
            *required
          </div>
        </div>
      </div>

      <div class="form-control">
        <label for="name">Minimum %</label>
        <input type="number" formControlName="kva_minpercentage" placeholder="Enter" required>
        <div *ngIf="form.get('kva_minpercentage')?.invalid && (form.get('kva_minpercentage')?.dirty || form.get('kva_minpercentage')?.touched)" class="error">
          <div *ngIf="form.get('kva_minpercentage')?.errors!required">
            *required
          </div>
        </div>
      </div>
      
    </form>

  </div>

  <ng-template pTemplate="footer">
    <div class="foot">
      <button class="button close" (click)="closeModal()" >CLOSE<fa-icon [icon]="cross"></fa-icon></button>
      <button class="button reset" (click)="resetFrom()">RESET<fa-icon [icon]="reset"></fa-icon></button>
      <button class="button ok" [disabled]="this.form.invalid" (click)="onSubmit()">{{ModalType}}<fa-icon [icon]="check"></fa-icon></button>
    </div>
  </ng-template>
</p-dialog>
