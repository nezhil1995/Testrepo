<body>
  <app-loader *ngIf="load == true" class="divloader"></app-loader>

  <app-maskloader *ngIf="maskLoad"></app-maskloader>

<div *ngIf="load != true">

  <div class="table">
    <div class="tabletop">
      <div class="add">
        <button *ngIf="loginType" class="button addBtn" (click)="showDialog()" ><fa-icon [icon]="add" [size]="'lg'"></fa-icon></button>
      </div>
      <div class="search">
        <span class="p-input-icon-left ml-auto">
          <i class="pi pi-search"></i>
          <input pInputText type="text" (input)="dt5.filterGlobal($any($event.target).value, 'contains')" placeholder="Search keyword" />
        </span>

        <form [formGroup]="Monthform">
          <div class="control">
            <label>Select Month</label>
            <p-calendar appendTo="body" [(ngModel)]="DefaultDate" formControlName="selectMonth" view="month" dateFormat="mm/yy" [readonlyInput]="true"
              [monthNavigator]="true"
              [yearNavigator]="true"
              [maxDate]="maxDate"
              (onSelect)="GetMonthCostData($event)"
              >
            </p-calendar>
          </div>
        </form>
      </div>
      <div class="delete">
        <button *ngIf="loginType" class="button delBtn" role="button" [disabled]="!selected.length" (click)="deleteselectedRows()" ><fa-icon [icon]="del" [size]="'lg'"></fa-icon></button>
      </div>
    </div>
    <p-table #dt5 id="exportwattable" [value]="WaterCosData" [tableStyle]="{ 'width': '100%' }" styleClass="p-datatable-gridlines"
      [(selection)]="selected"
      [paginator]="true"
      [rows]="50"
      [rowsPerPageOptions]="[50,100,500,1000]"
      [loading]="loading"
      [globalFilterFields]="['wt_date', 'wt_type', 'wt_source', 'wt_consume', 'wt_cost']"
      class="custom-table"
      [scrollable]="true"
      [scrollHeight]="TableHeight"
      >
      <ng-template pTemplate="header">
        <tr>
            <th *ngIf="loginType" style="width: 4rem">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th pSortableColumn="wt_date">DATE<p-sortIcon field="wt_date"></p-sortIcon></th>
            <th pSortableColumn="wt_type">TYPE<p-sortIcon field="wt_type"></p-sortIcon></th>
            <th pSortableColumn="wt_source">SOURCE<p-sortIcon field="wt_source"></p-sortIcon></th>
            <th pSortableColumn="wt_consume">LITER CONSUMED<p-sortIcon field="wt_consume"></p-sortIcon></th>
            <th pSortableColumn="wt_cost">COST PER LTR.<p-sortIcon field="wt_cost"></p-sortIcon></th>
            <th>TOTAL COST</th>
            <th *ngIf="loginType">EDIT</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-WaterCost>
        <tr>
            <td *ngIf="loginType">
              <p-tableCheckbox [value]="WaterCost"></p-tableCheckbox>
            </td>
            <td>{{WaterCost.wt_date}}</td>
            <td>{{WaterCost.wt_type}}</td>
            <td>{{WaterCost.wt_source}}</td>
            <td>{{WaterCost.wt_consume }}</td>
            <!-- <td *ngIf="!WaterCost.wt_cost_conform">
              <span *ngIf="!loginType">Not Authorized</span>
              <button *ngIf="loginType" class="addBtn1" role="button" (click)="showCostModal(WaterCost)" ><fa-icon [icon]="add"></fa-icon></button>
            </td>
            <td *ngIf="WaterCost.wt_cost_conform">
             {{Curr.symbol}} {{WaterCost.wt_cost}}
            </td> -->
            <td>{{WaterCost.wt_cost}}</td>
            <td>{{Curr.symbol}} {{this.TotalCost(WaterCost.wt_cost, WaterCost.wt_consume).toFixed(2) || "-"}}</td>
            <!-- <td *ngIf="loginType">
              <button *ngIf="WaterCost.wt_cost_conform && WaterCost.wt_source==='Rain Water'" class="edtBtn" role="button" (click)="EditModal(WaterCost)" ><fa-icon [icon]="edit" [size]="'lg'"></fa-icon></button>
              <span *ngIf="!WaterCost.wt_cost_conform">N/A</span>
            </td> -->
            <td *ngIf="loginType"><button class="edtBtn" role="button" (click)="EditModal(WaterCost)" ><fa-icon [icon]="edit" [size]="'lg'"></fa-icon></button></td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-Data>
      <tr>
        <td class="footd" colspan="7">No Data Available</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorright">
      <button class="Btn" (click)="exportExcel()">
        <div class="sign"><i class="fi fi-sr-file-excel"></i></div>
        <div class="text">EXPORT</div>
      </button>        
    </ng-template>
    </p-table>
  </div>

</div>
</body>

<p-dialog [(visible)]="DisplayCostModal" [draggable]="false" [closable]="false" [modal]="true">

  <div class="formdiv">

    <form [formGroup]="costForm" class="form">
      <div class="form-control">
        <label for="name">Cost per ltr</label>
        <input type="number" formControlName="wt_cost" placeholder="Enter" required>
        <div *ngIf="costForm.get('wt_cost')?.invalid && (costForm.get('wt_cost')?.dirty || costForm.get('wt_cost')?.touched)" class="error">
          <div *ngIf="costForm.get('wt_cost')?.errors!required">
            *required
          </div>
        </div>
      </div>
    </form>

  </div>


  <ng-template pTemplate="footer">
    <div class="foot">
      <button class="button close" (click)="closeModal()" >CLOSE<fa-icon [icon]="cross"></fa-icon></button>
      <button class="button reset" (click)="resetFrom()">RESET<fa-icon [icon]="reset"></fa-icon></button>
      <button class="button ok" [disabled]="this.costForm.invalid" (click)="onSubmit()">{{ModalType}}<fa-icon [icon]="check"></fa-icon></button>
    </div>
  </ng-template>

</p-dialog>


<p-dialog [(visible)]="DisplayModal" [draggable]="false" [closable]="false" [modal]="true">

  <div class="formdiv">

    <form [formGroup]="form" class="form">

      <div class="form-control">
        <label for="name">Date</label>
        <input type="date" formControlName="wt_date" placeholder="Enter" required>
        <div *ngIf="form.get('wt_date')?.invalid && (form.get('wt_date')?.dirty || form.get('wt_date')?.touched)" class="error">
          <div *ngIf="form.get('wt_date')?.errors!required">
            *required
          </div>
        </div>
      </div>

      <div class="form-control" *ngIf="this.ModalType==='ADD'">
        <label for="meter">Water Source</label>
        <select formControlName="wt_source">
          <option value="">-- Select Source --</option>
          <option *ngFor="let meter of source" [value]="meter">
            {{meter}}
          </option>
        </select>
        <div *ngIf="form.get('wt_source')?.invalid && (form.get('wt_source')?.dirty || form.get('wt_source')?.touched)" class="error">
          <div *ngIf="form.get('wt_source')?.errors!required">
            *required
          </div>
        </div>
      </div>

      <div class="form-control disable-control" *ngIf="this.ModalType==='UPDATE'">
        <label for="meter">Water Source</label>
        <input type="text" [readOnly]="true" formControlName="wt_source">
        <div *ngIf="form.get('wt_source')?.invalid && (form.get('wt_source')?.dirty || form.get('wt_source')?.touched)" class="error">
          <div *ngIf="form.get('wt_source')?.errors!required">
            *required
          </div>
        </div>
      </div>

      <!-- <div class="form-control">
        <label for="name">State</label>
        <label class="container">
          <input type="checkbox" checked="checked" formControlName="wt_state">
          <div class="checkmark"></div>
        </label>
        <div *ngIf="form.get('wt_state')?.invalid && (form.get('wt_state')?.dirty || form.get('wt_state')?.touched)" class="error">
          <div *ngIf="form.get('wt_state')?.errors!required">
            *required
          </div>
        </div>
      </div> -->

    </form>

    <!-- Fresh Water -->
    <div *ngIf="this.form.get('wt_source')?.value === 'Fresh_Water'" class="sourcgroupform sourceOver">

      <ng-container *ngFor="let Data of freshwaterData">
        <ng-container *ngIf="this.ModalType==='ADD'">
        <form [formGroup]="Data.formGroupName" class="source_form">
          <div class="source_form-control">
            <label for="name">{{Data.lableName}}</label>
            <input type="number" formControlName="wt_consume" placeholder="Enter" required>
            <div *ngIf="Data.formGroupName.get('wt_consume')?.invalid && (Data.formGroupName.get('wt_consume')?.dirty || Data.formGroupName.get('wt_consume')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_consume')?.errors!required">
                *required
              </div>
            </div> 
          </div>

          <div class="source_form-control">
            <label for="name">Cost</label>
            <input type="number" formControlName="wt_cost" placeholder="Enter" required>
            <div *ngIf="Data.formGroupName.get('wt_cost')?.invalid && (Data.formGroupName.get('wt_cost')?.dirty || Data.formGroupName.get('wt_cost')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_cost')?.errors!required">
                *required
              </div>
            </div>
          </div>
        </form>
        </ng-container>

        <ng-container *ngIf="this.ModalType==='UPDATE'">
        <form [formGroup]="Data.formGroupName" class="source_form" *ngIf="Data.lableName === this.selectedData.wt_type">
          <div class="source_form-control">
            <label for="name">{{Data.lableName}}</label>
            <input type="number" formControlName="wt_consume" [placeholder]="Data.placeHol" required>
            <div *ngIf="Data.formGroupName.get('wt_consume')?.invalid && (Data.formGroupName.get('wt_consume')?.dirty || Data.formGroupName.get('wt_consume')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_consume')?.errors!required">
                  *required
              </div>
            </div> 
          </div>
    
          <div class="source_form-control">
            <label for="name">Cost</label>
            <input type="number" formControlName="wt_cost" placeholder="Enter" required>
            <div *ngIf="Data.formGroupName.get('wt_cost')?.invalid && (Data.formGroupName.get('wt_cost')?.dirty || Data.formGroupName.get('wt_cost')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_cost')?.errors!required">
                  *required
              </div>
            </div>
          </div>
        </form>
        </ng-container>
      </ng-container>

    </div>

    <!-- Treated Water -->
    <div *ngIf="this.form.get('wt_source')?.value === 'Treated Water'" class="sourcgroupform sourceOver">

      <ng-container *ngFor="let Data of treatedwaterData">
        <ng-container *ngIf="this.ModalType==='ADD'">
        <form [formGroup]="Data.formGroupName" class="source_form">
          <div class="source_form-control">
            <label for="name">{{Data.lableName}}</label>
            <input type="number" formControlName="wt_consume" placeholder="Enter" required>
            <div *ngIf="Data.formGroupName.get('wt_consume')?.invalid && (Data.formGroupName.get('wt_consume')?.dirty || Data.formGroupName.get('wt_consume')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_consume')?.errors!required">
                *required
              </div>
            </div> 
          </div>
          <div class="source_form-control">
            <label for="name">Cost</label>
            <input type="number" formControlName="wt_cost" placeholder="Enter" required>
            <div *ngIf="Data.formGroupName.get('wt_cost')?.invalid && (Data.formGroupName.get('wt_cost')?.dirty || Data.formGroupName.get('wt_cost')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_cost')?.errors!required">
                  *required
              </div>
            </div>
          </div>
          </form>
          </ng-container>

          <ng-container *ngIf="this.ModalType==='UPDATE'">
            <form [formGroup]="Data.formGroupName" class="source_form" *ngIf="Data.lableName === this.selectedData.wt_type">
              <div class="source_form-control">
                <label for="name">{{Data.lableName}}</label>
                <input type="number" formControlName="wt_consume" placeholder="Enter" required>
                <div *ngIf="Data.formGroupName.get('wt_consume')?.invalid && (Data.formGroupName.get('wt_consume')?.dirty || Data.formGroupName.get('wt_consume')?.touched)" class="error">
                  <div *ngIf="Data.formGroupName.get('wt_consume')?.errors!required">
                    *required
                  </div>
                </div> 
              </div>
              <div class="source_form-control">
                <label for="name">Cost</label>
                <input type="number" formControlName="wt_cost" placeholder="Enter" required>
                <div *ngIf="Data.formGroupName.get('wt_cost')?.invalid && (Data.formGroupName.get('wt_cost')?.dirty || Data.formGroupName.get('wt_cost')?.touched)" class="error">
                  <div *ngIf="Data.formGroupName.get('wt_cost')?.errors!required">
                      *required
                  </div>
                </div>
              </div>
            </form>
            </ng-container>
        </ng-container>

    </div>

    <!-- Rain Water -->
    <div *ngIf="this.form.get('wt_source')?.value === 'Rain Water'" class="sourcgroupform">

      <ng-container *ngFor="let Data of rainwaterData">
        <ng-container *ngIf="this.ModalType==='ADD'">
        <form [formGroup]="Data.formGroupName" class="source_form">
          <div class="source_form-control">
            <label for="name">{{Data.lableName}}</label>
            <input type="number" formControlName="wt_consume" placeholder="Enter" required>
            <div *ngIf="Data.formGroupName.get('wt_consume')?.invalid && (Data.formGroupName.get('wt_consume')?.dirty || Data.formGroupName.get('wt_consume')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_consume')?.errors!required">
                *required
              </div>
            </div> 
          </div>
          <!-- <div class="source_form-control">
            <label for="name">Cost</label>
            <input type="number" formControlName="wt_cost" placeholder="Enter" required [(ngModel)]="this.raincost" [readOnly]="true">
            <div *ngIf="Data.formGroupName.get('wt_cost')?.invalid && (Data.formGroupName.get('wt_cost')?.dirty || Data.formGroupName.get('wt_cost')?.touched)" class="error">
              <div *ngIf="Data.formGroupName.get('wt_cost')?.errors!required">
                *required
              </div>
            </div>
          </div> -->
        </form>
        </ng-container>

        <ng-container *ngIf="this.ModalType==='UPDATE'">
          <form [formGroup]="Data.formGroupName" class="source_form" *ngIf="Data.lableName === this.selectedData.wt_type">
            <div class="source_form-control">
              <label for="name">{{Data.lableName}}</label>
              <input type="number" formControlName="wt_consume" placeholder="Enter" required>
              <div *ngIf="Data.formGroupName.get('wt_consume')?.invalid && (Data.formGroupName.get('wt_consume')?.dirty || Data.formGroupName.get('wt_consume')?.touched)" class="error">
                <div *ngIf="Data.formGroupName.get('wt_consume')?.errors!required">
                  *required
                </div>
              </div> 
            </div>
            <!-- <div class="source_form-control">
              <label for="name">Cost</label>
              <input type="number" formControlName="wt_cost" placeholder="Enter" required  [(ngModel)]="this.raincost" [readOnly]="true">
              <div *ngIf="Data.formGroupName.get('wt_cost')?.invalid && (Data.formGroupName.get('wt_cost')?.dirty || Data.formGroupName.get('wt_cost')?.touched)" class="error">
                <div *ngIf="Data.formGroupName.get('wt_cost')?.errors!required">
                  *required
                </div>
              </div>
            </div> -->
          </form>
        </ng-container>
      </ng-container>

    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="foot">
      <button class="button close" (click)="closeModal()" >CLOSE<fa-icon [icon]="cross"></fa-icon></button>
      <button class="button reset" (click)="resetFrom()">RESET<fa-icon [icon]="reset"></fa-icon></button>
      <button class="button ok" [disabled]="ButtonOnDisable(this.form.get('wt_source')?.value)" (click)="onSubmit()">{{ModalType}}<fa-icon [icon]="check"></fa-icon></button>
    </div>
  </ng-template>
</p-dialog>
